<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Our Little World</title>
<style>
  body {
    margin: 0;
    background: #1a1a1a;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: monospace;
    color: white;
  }
  canvas {
    image-rendering: pixelated;
    border: 4px solid #333;
    background: #2b2b2b;
  }
  #popup {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.8);
    padding: 14px 18px;
    border-radius: 12px;
    max-width: 420px;
    text-align: center;
    display: none;
  }
</style>
</head>
<body>
<canvas id="game" width="640" height="480"></canvas>
<div id="popup"></div>

<audio id="music" loop>
  <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_5a4b2c0f6e.mp3" type="audio/mpeg">
</audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const popup = document.getElementById("popup");
const music = document.getElementById("music");
music.volume = 0.4;
music.play().catch(()=>{});

const TILE = 32;

const map = [
"####################",
"#..H......T.....A..#",
"#..................#",
"#....PPPP..........#",
"#....P..P....C.....#",
"#....PPPP..........#",
"#..................#",
"#.........B........#",
"#..................#",
"#..............L...#",
"####################"
];

const locations = {
  H: "Home — where warm mornings and sleepy smiles live.",
  C: "Café — we stayed too long and didn’t regret a minute.",
  B: "Bench — quiet talks that said everything.",
  A: "Arcade — competitive, chaotic, and adorable.",
  L: "A quiet hill path… locked for now."
};

const hearts = [
  {x:3,y:2,msg:"You are my favorite notification."},
  {x:10,y:6,msg:"Achievement unlocked: stole my heart."},
  {x:15,y:3,msg:"Bug report: falling for you repeatedly."},
  {x:6,y:8,msg:"You + Me = unfair advantage."},
  {x:12,y:2,msg:"Warning: excessive cuteness detected."}
];

let collected = 0;

const player = {x:2,y:2};

const keys = {};
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

function showPopup(text) {
  popup.innerText = text;
  popup.style.display = "block";
  clearTimeout(showPopup.t);
  showPopup.t = setTimeout(()=>popup.style.display="none", 3500);
}

function tileAt(x,y){
  return map[y][x];
}

function walkable(x,y){
  return tileAt(x,y) !== '#';
}

function update(){
  let nx = player.x;
  let ny = player.y;
  if(keys["ArrowUp"]) ny--;
  if(keys["ArrowDown"]) ny++;
  if(keys["ArrowLeft"]) nx--;
  if(keys["ArrowRight"]) nx++;

  if(walkable(nx,ny)){
    player.x = nx;
    player.y = ny;
  }

  const t = tileAt(player.x,player.y);
  if(locations[t]){
    if(t === 'L' && collected < hearts.length){
      showPopup("The hill waits until every memory is found.");
    } else if(t === 'L'){
      showPopup("Final Hill — Under these stars, I’d choose you every time.");
    } else {
      showPopup(locations[t]);
    }
  }

  hearts.forEach(h=>{
    if(!h.got && h.x===player.x && h.y===player.y){
      h.got = true;
      collected++;
      showPopup(h.msg);
    }
  });
}

let glow = 0;
function draw(){
  glow += 0.05;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  for(let y=0;y<map.length;y++){
    for(let x=0;x<map[y].length;x++){
      const t = map[y][x];
      if(t==="#"){
        ctx.fillStyle="#5a3c2e";
        ctx.fillRect(x*TILE,y*TILE,TILE,TILE);
      } else {
        ctx.fillStyle="#3e2f2a";
        ctx.fillRect(x*TILE,y*TILE,TILE,TILE);
      }

      if(t==="P"){
        const sway = Math.sin(glow + x)*2;
        ctx.fillStyle="#4caf50";
        ctx.fillRect(x*TILE+12,y*TILE+6+sway,8,20);
      }

      if(t==="T"){
        const g = (Math.sin(glow*2)+1)/2;
        ctx.fillStyle = `rgba(255,220,120,${0.5+g*0.5})`;
        ctx.fillRect(x*TILE+10,y*TILE+10,12,12);
      }
    }
  }

  hearts.forEach(h=>{
    if(!h.got){
      const bob = Math.sin(glow*2 + h.x)*4;
      ctx.fillStyle="#ff6b81";
      ctx.fillRect(h.x*TILE+10,h.y*TILE+10+bob,12,12);
    }
  });

  ctx.fillStyle="#ffd166";
  ctx.fillRect(player.x*TILE+8,player.y*TILE+8,16,16);

  if(collected === hearts.length){
    for(let i=0;i<30;i++){
      ctx.fillStyle = "rgba(255,255,255,0.8)";
      ctx.fillRect((i*53)%640, (i*97)%480, 2,2);
    }
  }
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
